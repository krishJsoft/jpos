<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<h:form id="addEditDoctorsPrescriptionForm">
		<p:outputPanel id="dpPanel">
			<table align="center" width="100%" border="0">
				<tr>
					<td align="center"><p:message for="dpPanel" /></td>
				</tr>
			</table>
			<p:panel styleClass="mypanel" header="Add/Edit Doctor Prescription">



				<h:panelGrid id="dpGrid" columns="15" border="0" width="100%"
					columnClasses="columnLeft width-5px, columnLeft width-120px, columnLeft width-10px, columnLeft width-280px, columnLeft width-280px ,columnLeft">


					<h:outputText value="*" styleClass="mandatory_text" />


					<h:panelGrid columns="2">
						<h:outputText
							value="#{msg['doctorsprescriptions.label.patient.name']}"
							styleClass="logintxt"></h:outputText>

						<p:commandButton id="customerBtn" icon="ui-icon-search" onclick="PF('overcustomer').show();"
							style="height:22px;" update="customerPanel" />
					</h:panelGrid>

					<h:outputText value=":" />
					<p:inputText id="patientName"
						value="#{dpBean.customer.customerName}" size="25" />
					<p:message for="patientName" styleClass="fieldError" />

					<h:outputText value="*" styleClass="mandatory_text" />
					<h:outputText value="#{msg['doctorsprescriptions.label.date']} "
						styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:calendar navigator="true" id="date" size="25"
						value="#{dpBean.dpModel.createdDate}" pattern="dd/MM/yyyy" />
					<p:message for="date" styleClass="fieldError" />


					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="#{msg['doctorsprescriptions.label.remarks']}"
						styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:inputTextarea rows="3" cols="25" id="remarks"
						value="#{dpBean.dpModel.remarks}" />
					<p:message for="remarks" styleClass="fieldError" />



				</h:panelGrid>



				<br />

				<p:panelGrid style="width:99%" id="prescriptionProductGrid"
					styleClass="alignTop">
					<f:facet name="header">
						<p:row>
							<p:column style="width:100%;">Add Product</p:column>
						</p:row>
					</f:facet>

					<p:row>


						<p:column style="width:100%;" styleClass="alignTop">




							<p:message for="productCode" styleClass="fieldError" />
							<p:message for="quantity" styleClass="fieldError" />
							<p:message for="dose" styleClass="fieldError" />
							<p:message for="medicineForm" styleClass="fieldError" />
							<p:message for="frequency" styleClass="fieldError" />
							<p:message for="takeM" styleClass="fieldError" />
							<p:message for="takeA" styleClass="fieldError" />
							<p:message for="takeN" styleClass="fieldError" />
							<p:message for="medicaitonPeriod" styleClass="fieldError" />




							<h:panelGrid id="prescriptionAddGrid" columns="6" border="0"
								styleClass="borderlessGrid" width="70%"
								columnClasses="columnLeft width-5px, columnLeft width-120px, columnLeft width-10px, columnLeft width-280px, columnLeft width-280px ,columnLeft">





								<h:panelGrid columns="2">
									<p:commandButton id="productBtn" icon="ui-icon-search" onclick="PF('overproduct').show();"
										style="height:22px;" update="productPanel" />

									<h:outputText
										value="#{msg['purchaserequest.label.productCode']}"
										styleClass="logintxt"></h:outputText>
								</h:panelGrid>

								<p:autoComplete id="productCode" maxResults="500" size="25"
									converter="productNameConverter" maxlength="15"
									value="#{dpBean.dpbModel.product}" minQueryLength="3"
									dropdown="false" scrollHeight="250" queryDelay="2"
									completeMethod="#{dpBean.getProductCode}" var="p"
									itemLabel="#{p.productName}" itemValue="#{p}">
									<p:column>  
                                   #{p.productName} - #{p.uom} 
                                  </p:column>
								</p:autoComplete>


								<h:outputText
									value="#{msg['doctorsprescriptions.label.quantity']}"
									styleClass="logintxt"></h:outputText>
								<p:inputText id="quantity" value="#{dpBean.dpbModel.quantity}" />


								<h:outputText value="#{msg['doctorsprescriptions.label.dose']}"
									styleClass="logintxt"></h:outputText>
								<p:inputText id="dose" value="#{dpBean.dpbModel.dose}" />


								<h:outputText value="#{msg['doctorsprescriptions.label.form']}"
									styleClass="logintxt"></h:outputText>

								<h:panelGrid columns="2">
									<p:selectOneMenu id="medicineForm"
										style="width:70px; text-align:left;"
										value="#{dpBean.dpbModel.formName}" styleClass="inputCombo">
										<f:selectItem itemLabel="Tablet" itemValue="Tablet" />
										<f:selectItem itemLabel="Capsule" itemValue="Capsule" />
									</p:selectOneMenu>
									<p:selectOneMenu id="medicineForm1"
										style="width:100px; text-align:left;"
										value="#{dpBean.dpbModel.formName}" styleClass="inputCombo">
										<f:selectItem itemLabel="Before Food" itemValue="Before Food" />
										<f:selectItem itemLabel="After Food" itemValue="After Food" />
									</p:selectOneMenu>
								</h:panelGrid>




								<h:outputText
									value="#{msg['doctorsprescriptions.label.frequency']}"
									styleClass="logintxt"></h:outputText>
								<p:inputText id="frequency" value="#{dpBean.dpbModel.frequency}" />


								<h:outputText value="#{msg['doctorsprescriptions.label.take']}"
									styleClass="logintxt"></h:outputText>

								<h:panelGrid id="takeGrid" columns="6" cellpadding="0"
									styleClass="borderlessGrid" cellspacing="0"
									style="width:150px;">

									<h:outputText value="M" styleClass="logintxt"></h:outputText>
									<p:inputText id="takeM" value="#{dpBean.dpbModel.takeM}"
										size="4" />
									<h:outputText value="A" styleClass="logintxt"></h:outputText>
									<p:inputText id="takeA" value="#{dpBean.dpbModel.takeA}"
										size="4" />
									<h:outputText value="N" styleClass="logintxt"></h:outputText>
									<p:inputText id="takeN" value="#{dpBean.dpbModel.takeN}"
										size="4" />
								</h:panelGrid>






								<h:outputText
									value="#{msg['doctorsprescriptions.label.medicaitonPeriod']}"
									styleClass="logintxt"></h:outputText>

								<p:inputText id="medicaitonPeriod"
									value="#{dpBean.dpbModel.medicationPeriod}" />



								<h:outputText value="" />
								<h:panelGrid columns="2" border="0" styleClass="borderlessGrid"
									columnClasses="columnLeft width-120px, columnLeft width-180px,columnLeft">
									<p:commandButton value="Add" ajax="true"
										action="#{dpBean.addBreakdown}"
										rendered="#{dpBean.supplieraction!='update'}"
										update="prescriptionProductGrid" />

									<p:commandButton value="Update" ajax="true"
										rendered="#{dpBean.supplieraction=='update'}"
										action="#{dpBean.updateSubscriptionItemConfirm}"
										update="prescriptionProductGrid" />

									<p:commandButton value="Reset" ajax="true"
										rendered="#{dpBean.supplieraction=='update'}"
										action="#{dpBean.resetDpbreakdown}"
										update="prescriptionProductGrid" />

									<p:commandButton value="Reset" ajax="true"
										rendered="#{dpBean.supplieraction!='update'}"
										action="#{dpBean.restBreakdown}"
										update="prescriptionProductGrid" />



								</h:panelGrid>

							</h:panelGrid>

						</p:column>
					</p:row>

					<p:row>
						<p:column style="width:100%;" styleClass="alignTop"
							id="productcol">


							<p:dataTable id="dataTable" var="breakdown" rowIndexVar="row"
								scrollable="true" scrollHeight="300" value="#{dpBean.dpbModels}"
								paginator="false" rows="500" style="width: 100%"
								rowsPerPageTemplate="5,10,15"
								rowStyleClass="#{row mod 2 == 0 ? 'old1' : 'old'}">



								<p:column width="10%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value="Product Code" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.product.barcode}"
										styleClass="logintxttable" />
								</p:column>

								<p:column width="20%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value="Product Name" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.product.productName}"
										styleClass="logintxttable" />
								</p:column>




								<p:column width="10%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value="Dose" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.dose}"
										styleClass="logintxttable" />
								</p:column>

								<p:column width="10%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value="Form" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.formName}"
										styleClass="logintxttable" />
								</p:column>

								<p:column width="10%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value="Frequency" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.frequency}"
										styleClass="logintxttable" />
								</p:column>

								<p:column width="5%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value=" M" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.takeM}"
										styleClass="logintxttable" />
								</p:column>


								<p:column width="5%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value=" A" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.takeA}"
										styleClass="logintxttable" />
								</p:column>


								<p:column width="5%" styleClass="columnwidth">
									<f:facet name="header">
										<h:outputText value=" N" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.takeN}"
										styleClass="logintxttable" />
								</p:column>


								<p:column style="width: 5%;" styleClass="logintxtnumberFormat">
									<f:facet name="header">
										<h:outputText value="Qty" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.quantity}"
										styleClass="logintxttable" />
								</p:column>

								<p:column style="width: 11%;" styleClass="logintxtnumberFormat">
									<f:facet name="header">
										<h:outputText value="Unit Price(RM)" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.unitPrice}"
										styleClass="logintxttable" />
								</p:column>

								<p:column style="width: 12%;" styleClass="logintxtnumberFormat">
									<f:facet name="header">
										<h:outputText value="Sub Total (RM)" styleClass="tableheader" />
									</f:facet>
									<h:outputText value="#{breakdown.subTotal}"
										styleClass="logintxttable" />
								</p:column>


								<p:column width="9%" styleClass="columnwidth">
									<f:facet name="header">Action</f:facet>



									<h:panelGrid columns="10" border="0"
										styleClass="borderlessGrid">
										<p:commandLink value="" styleClass="ui-icon ui-icon-pencil"
											title="Edit"
											update=":addEditDoctorsPrescriptionForm:prescriptionAddGrid"
											actionListener="#{dpBean.editSubscriptionItem}">
											<f:attribute name="dpbcode" value="#{row}" />
										</p:commandLink>

										<h:graphicImage value="resources/images/cal_forward.gif"
											rendered="#{loginBean.functionList.contains('Edit PurchaseRequest')}" />


										<p:commandLink value="" styleClass="ui-icon ui-icon-trash"
											title="Remove"
											update=":addEditDoctorsPrescriptionForm:prescriptionDelete"
											actionListener="#{dpBean.removeBreakdown}"
											oncomplete="PF('prescriptionDeleteDig').show()">
											<f:attribute name="barcode"
												value="#{breakdown.product.barcode}" />
											<f:attribute name="dpbcode" value="#{row}" />
										</p:commandLink>
									</h:panelGrid>


								</p:column>


							</p:dataTable>

							<table align="center" width="100%" border="0">
								<tr>
									<td align="right"><h:outputText
											value="#{dpBean.dpModel.totalAmount}" styleClass="totalValue" /></td>
								</tr>
							</table>


						</p:column>
					</p:row>

				</p:panelGrid>

				<br />

				<p:commandButton value="Save" ajax="false"
					rendered="#{dpBean.action=='save'}"
					action="#{dpBean.saveDoctorsPrescription}" update="dpPanel" />

				<p:commandButton value="Update" ajax="false"
					rendered="#{dpBean.action=='update'}"
					action="#{dpBean.updateDoctorsPrescription}" update="dpPanel" />

				<p:commandButton value="Reset" ajax="true"
					action="#{dpBean.restOnSave}" update="dpPanel"
					rendered="#{dpBean.action=='save'}" />

				<p:commandButton value="Reset" ajax="true"
					actionListener="#{dpBean.editDoctorsPrescription}" update="dpPanel"
					rendered="#{dpBean.action=='update'}">
					<f:attribute name="dpId"
						value="#{dpBean.dpModel.doctorPrescriptionId}" />
				</p:commandButton>


				<p:commandButton value="Cancel" ajax="false"
					action="#{dpBean.cancel}" update="dpPanel" />

			</p:panel>


		</p:outputPanel>

		<p:overlayPanel id="productSearchPanel" for="productBtn"
			hideEffect="fade" widgetVar="overproduct" showCloseIcon="true"
			style="width:70%;" dynamic="true">
			<h:panelGroup id="productPanel" stateless="true">


				<h:panelGrid id="searchproductgrid" columns="25" border="0"
					width="100%"
					columnClasses="columnLeft width-5px, columnLeft width-120px, columnLeft width-10px, columnLeft width-280px, columnLeft width-280px ,columnLeft">



					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="Product Code " styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:inputText id="pbarcode" value="#{productBean.barcode}"
						maxlength="45" size="15" />
					<p:message for="pbarcode" styleClass="fieldError" />

					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="Product Name " styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:inputText id="pproductName" value="#{productBean.productName}"
						maxlength="200" size="20" />
					<p:message for="pproductName" styleClass="fieldError" />

					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="Brand Name " styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:inputText id="brandName" value="#{productBean.brandName}"
						maxlength="200" size="20" />
					<p:message for="brandName" styleClass="fieldError" />


					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="#{msg['product.label.categoryName']}"
						styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<h:panelGrid columns="2" border="0">
						<p:commandLink id="categoryBtn" value="Select" onclick="PF('overp').show();"/>
					</h:panelGrid>
					<h:outputText value="" />


					<h:outputText value="" />
					<h:outputText value="" />
					<h:outputText value="" />
					<h:panelGrid columns="2" border="0"
						columnClasses="columnLeft width-120px, columnLeft width-180px,columnLeft">
						<p:commandButton ajax="true" icon="ui-icon-search"
							style="height:22px;" action="#{productBean.searchProduct}"
							update="productPanel" />
					</h:panelGrid>
					<h:outputText value="" />

				</h:panelGrid>

				<p:dataTable id="productdataTable" var="product" rowIndexVar="row"
					paginatorPosition="top" lazy="true"
					value="#{productBean.productModel}" scrollable="true"
					first="#{productBean.first}" scrollHeight="200"
					selectionMode="single" paginator="true" rows="10"
					style="width:100%" rowsPerPageTemplate="10,15,25,50,100,250,500"
					rowStyleClass="#{row mod 2 == 0 ? null : 'old'}">

					<p:ajax event="page" listener="#{productBean.onPageChange}" />

					<p:ajax event="rowSelect" listener="#{dpBean.selectProduct}"
						oncomplete="PF('overproduct').hide();"
						update=":addEditDoctorsPrescriptionForm:prescriptionAddGrid">
						<f:attribute name="product" value="#{product}" />
					</p:ajax>



					<p:column sortBy="#{product.barcode}" styleClass="columnwidth"
						width="8%">
						<f:facet name="header">
							<h:outputText value="Product Code" />
						</f:facet>
						<h:outputText value="#{product.barcode}"
							styleClass="logintxttable" />
					</p:column>

					<p:column sortBy="#{product.productName}" styleClass="columnwidth"
						width="20%">
						<f:facet name="header">
							<h:outputText value="Product Name" />
						</f:facet>
						<h:outputText value="#{product.productName}"
							styleClass="logintxttable" />
					</p:column>




					<p:column sortBy="#{product.brandName}" styleClass="columnwidth"
						width="10%">
						<f:facet name="header">
							<h:outputText value="Brand" />
						</f:facet>
						<h:outputText value="#{product.brandName}"
							styleClass="logintxttable" />
					</p:column>

					<p:column sortBy="#{product.categoryName}" styleClass="columnwidth"
						width="10%">
						<f:facet name="header">
							<h:outputText value="Category" />
						</f:facet>
						<h:outputText value="#{product.categoryName}"
							styleClass="logintxttable" />
					</p:column>


					<p:column width="4%">
						<f:facet name="header">
							<h:outputText value="UOM Type" />
						</f:facet>
						<h:outputText value="#{product.uom}" styleClass="logintxttable" />
					</p:column>


				</p:dataTable>


			</h:panelGroup>


		</p:overlayPanel>



		<p:overlayPanel id="customerSearchPanel" for="customerBtn"
			hideEffect="fade" widgetVar="overcustomer" showCloseIcon="true"
			style="width:70%;" dynamic="true">
			<h:panelGroup id="customerPanel" stateless="true">




				<h:panelGrid id="customerproductgrid" columns="25" border="0"
					width="100%"
					columnClasses="columnLeft width-5px, columnLeft width-120px, columnLeft width-10px, columnLeft width-280px, columnLeft width-280px ,columnLeft">



					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="IC No" styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:inputText id="oidentificationCompanyRegNo"
						value="#{customerBean.identificationCompanyRegNo}" maxlength="15"
						size="25" />
					<p:message for="oidentificationCompanyRegNo"
						styleClass="fieldError" />

					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="Customer Name" styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:inputText id="ocustomerName"
						value="#{customerBean.customerName}" maxlength="15" size="25" />
					<p:message for="ocustomerName" styleClass="fieldError" />

					<h:outputText value="" styleClass="mandatory_text" />
					<h:outputText value="Loylty Code" styleClass="logintxt"></h:outputText>
					<h:outputText value=":" />
					<p:inputText id="oloyaltyCardCode"
						value="#{customerBean.loyaltyCardCode}" maxlength="15" size="25" />
					<p:message for="oloyaltyCardCode" styleClass="fieldError" />



					<h:outputText value="" />
					<h:outputText value="" />
					<h:outputText value="" />
					<h:panelGrid columns="2" border="0"
						columnClasses="columnLeft width-120px, columnLeft width-180px,columnLeft">
						<p:commandButton icon="ui-icon-search" style="height:22px;"
							ajax="true" action="#{customerBean.searchCustomer}"
							update="customerPanel" />

					</h:panelGrid>
					<h:outputText value="" />

				</h:panelGrid>




				<p:dataTable id="customerdataTable" var="customer" rowIndexVar="row"
					paginatorPosition="top" lazy="true"
					value="#{customerBean.customerModel}" first="#{customerBean.first}"
					scrollable="true" scrollHeight="200" paginator="true" rows="10"
					style="width: 100%" selectionMode="single"
					rowsPerPageTemplate="5,10,15,25,50,100"
					rowStyleClass="#{row mod 2 == 0 ? null : 'old'}">

					<p:ajax event="page" listener="#{customerBean.onPageChange}" />

					<p:ajax event="rowSelect" oncomplete="PF('overcustomer').hide();"
						listener="#{dpBean.selectCustomer}"
						update=":addEditDoctorsPrescriptionForm:patientName">
					</p:ajax>

					<p:column sortBy="#{customer.customerName}" width="15%"
						styleClass="columnwidth">
						<f:facet name="header">
							<h:outputText value="#{msg['customer.label.customerName']}" />
						</f:facet>
						<h:outputText value="#{customer.customerName}"
							styleClass="logintxttable" />
					</p:column>


					<p:column sortBy="#{customer.identificationCompanyRegNo}"
						width="10%" styleClass="columnwidth">
						<f:facet name="header">
							<h:outputText value="IC No" styleClass="tableheader" />
						</f:facet>
						<h:outputText value="#{customer.identificationCompanyRegNo}"
							styleClass="logintxttable" />
					</p:column>

					<p:column width="15%" styleClass="columnwidth">
						<f:facet name="header">
							<h:outputText value="Email" />
						</f:facet>
						<h:outputText value="#{customer.emailAddress}"
							styleClass="logintxttable" />
					</p:column>

					<p:column width="10%" styleClass="columnwidth">
						<f:facet name="header">
							<h:outputText value="Loylty Code" />
						</f:facet>
						<h:outputText value="#{customer.loyaltyCardCode}"
							styleClass="logintxttable" />
					</p:column>

					<p:column width="5%" styleClass="logintxtnumberFormat">
						<f:facet name="header">
							<h:outputText value="Points" />
						</f:facet>
						<h:outputText value="#{customer.availablePoints}"
							styleClass="logintxttable" />
					</p:column>

				</p:dataTable>



			</h:panelGroup>


		</p:overlayPanel>



		<ui:include src="/admin/categoryOverlayout.xhtml" />

		<ui:include src="/sales/doctorsPrescriptionsBreakdownDelete.xhtml" />

	</h:form>
</ui:composition>


